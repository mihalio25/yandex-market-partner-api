# Скрипт обновления цен товаров в Яндекс.Маркете

Этот набор скриптов позволяет автоматически увеличивать цены товаров в Яндекс.Маркете с использованием различных стратегий и фильтров.

## Файлы

- `price_updater.py` - Основной модуль с классами для обновления цен
- `price_updater_cli.py` - CLI интерфейс для командной строки
- `debug_offers.py` - Отладочный скрипт для анализа структуры товаров

## Возможности

### Стратегии увеличения цен

1. **Процентное увеличение** (`percentage`) - увеличение на заданный процент
2. **Фиксированная сумма** (`fixed_amount`) - увеличение на фиксированную сумму в рублях
3. **Округление** (`round_up`) - увеличение с округлением до красивых цифр
4. **Конкурентное ценообразование** (`competitive`) - увеличение с округлением до .99

### Фильтры товаров

- **По цене**: минимальная и максимальная текущая цена
- **По категории**: частичное совпадение в названии категории
- **По названию**: частичное совпадение в названии товара
- **Исключение по SKU**: исключить определенные товары

### Ограничения новых цен

- Минимальная и максимальная новая цена
- Автоматическая проверка на минимальное изменение (1 копейка)

## Использование

### Интерактивный режим

```bash
python3 price_updater.py
```

Скрипт предложит выбрать стратегию и параметры через интерактивное меню.

### CLI режим

```bash
python3 price_updater_cli.py --api-key YOUR_KEY --campaign-id CAMPAIGN_ID --strategy STRATEGY --value VALUE [OPTIONS]
```

#### Примеры использования

1. **Увеличить все цены на 10% в тестовом режиме:**
```bash
python3 price_updater_cli.py \
  --api-key "YOUR_API_KEY" \
  --campaign-id 12345 \
  --strategy percentage \
  --value 10 \
  --dry-run
```

2. **Увеличить цены на 100 рублей для товаров дороже 1000 рублей:**
```bash
python3 price_updater_cli.py \
  --api-key "YOUR_API_KEY" \
  --campaign-id 12345 \
  --strategy fixed_amount \
  --value 100 \
  --min-price 1000
```

3. **Конкурентное увеличение на 15% для зарядных устройств:**
```bash
python3 price_updater_cli.py \
  --api-key "YOUR_API_KEY" \
  --campaign-id 12345 \
  --strategy competitive \
  --value 15 \
  --category "зарядн"
```

4. **Округление цен с увеличением на 5% для товаров от 500 до 5000 рублей:**
```bash
python3 price_updater_cli.py \
  --api-key "YOUR_API_KEY" \
  --campaign-id 12345 \
  --strategy round_up \
  --value 5 \
  --min-price 500 \
  --max-price 5000
```

### Параметры CLI

#### Основные параметры
- `--api-key` - API ключ Яндекс.Маркета (обязательный)
- `--campaign-id` - ID кампании (обязательный)
- `--strategy` - Стратегия увеличения цен (по умолчанию: percentage)
- `--value` - Значение для стратегии (обязательный)

#### Фильтры товаров
- `--min-price` - Минимальная текущая цена товара
- `--max-price` - Максимальная текущая цена товара
- `--category` - Фильтр по категории (частичное совпадение)
- `--name-filter` - Фильтр по названию товара
- `--exclude-skus` - Исключить товары по SKU/offerId

#### Ограничения новых цен
- `--min-new-price` - Минимальная новая цена
- `--max-new-price` - Максимальная новая цена

#### Настройки выполнения
- `--batch-size` - Размер пакета для обновления (по умолчанию: 50)
- `--delay` - Задержка между пакетами в секундах (по умолчанию: 1)
- `--dry-run` - Тестовый режим (не применять изменения)
- `--limit` - Максимальное количество товаров для обработки (по умолчанию: 200)

#### Дополнительные опции
- `--verbose, -v` - Подробный вывод
- `--quiet, -q` - Минимальный вывод

## Безопасность

### Тестовый режим
Всегда используйте `--dry-run` для тестирования перед реальным применением изменений.

### Логирование
Скрипт создает подробные логи:
- `price_updates_YYYYMMDD_HHMMSS.log` - общий лог выполнения
- `price_changes_YYYYMMDD_HHMMSS.csv` - детальный лог изменений цен

### Ограничения
- Минимальное изменение цены: 1 копейка
- Пакетная обработка для снижения нагрузки на API
- Задержки между запросами

## Стратегии в деталях

### 1. Процентное увеличение (percentage)
```
новая_цена = текущая_цена * (1 + процент / 100)
```
Пример: цена 1000 руб + 10% = 1100 руб

### 2. Фиксированная сумма (fixed_amount)
```
новая_цена = текущая_цена + сумма
```
Пример: цена 1000 руб + 100 руб = 1100 руб

### 3. Округление (round_up)
```
новая_цена = round(текущая_цена * (1 + процент / 100), разряд)
```
- До 100 руб: округление до десятков
- До 1000 руб: округление до сотен  
- Свыше 1000 руб: округление до тысяч

Пример: цена 1234 руб + 5% = 1300 руб (округлено до сотен)

### 4. Конкурентное ценообразование (competitive)
```
новая_цена = int(текущая_цена * (1 + процент / 100)) + 0.99
```
Пример: цена 1000 руб + 10% = 1099.99 руб

## Примеры результатов

### CSV лог изменений
```csv
sku,name,status,old_price,new_price,change_amount,change_percent,description,reason
124243242,Сетевое зарядное устройство 20W USB-C,PLANNED,2990.0,3289.99,299.99,10.03,Конкурентное увеличение на 10.0%,
```

### Статистика выполнения
```
==================================================
РЕЗУЛЬТАТ ОБНОВЛЕНИЯ ЦЕН
==================================================
Успешно обновлено: 43
Ошибок: 0
Пропущено: 0
==================================================
```

## Требования

- Python 3.7+
- Модуль `yandex_market_api.py`
- API ключ Яндекс.Маркета
- ID кампании

## Отладка

Для анализа структуры товаров используйте:
```bash
python3 debug_offers.py
```

Этот скрипт покажет подробную структуру данных первых нескольких товаров.

## Поддержка

При возникновении проблем:
1. Проверьте логи выполнения
2. Убедитесь в корректности API ключа и ID кампании
3. Используйте тестовый режим для проверки
4. Проверьте фильтры - возможно, они исключают все товары

## Лицензия

Скрипт предоставляется "как есть" для использования с API Яндекс.Маркета. 